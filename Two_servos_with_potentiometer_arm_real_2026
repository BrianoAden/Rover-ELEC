#include <ESP32Servo.h>

Servo myServo1;  // Create servo object
Servo myServo2;  // Create servo object


const int potPin1 = 34;    // ADC1 channel suitable for input
const int potPin2 = 33;    // ADC1 channel suitable for input

const int servoPin1 = 18;  // PWM capable pin
const int servoPin2 = 19;  // PWM capable pin


// Variables
int potValue1 = 0;
int potValue2 = 0;

int servoAngle1 = 0;
int servoAngle2 = 0;


void setup() {
  Serial.begin(115200);

  // Allow allocation of all timers
  ESP32PWM::allocateTimer(0);
  ESP32PWM::allocateTimer(1);
  ESP32PWM::allocateTimer(2);
  ESP32PWM::allocateTimer(3);

  // Standard 50hz servo frequency
  myServo1.setPeriodHertz(50); 
  myServo2.setPeriodHertz(50); 

  
  // Attach the servo to the pin. 
  // DS3240 servos often use a pulse width range of 500us to 2500us
  myServo1.attach(servoPin1, 500, 2500);
  myServo2.attach(servoPin2, 500, 2500);

}

void loop() {
  // 1. Read Potentiometer
  // ESP32 ADC resolution is 12-bit (values 0-4095)
  potValue1 = analogRead(potPin1);
  potValue2 = analogRead(potPin2);


  Serial.println(potValue1);
  Serial.println(potValue2);


  // 2. Map Value
  // Map the 0-4095 input range to the 0-180 degree servo range
  servoAngle1 = map(potValue1, 0, 4095, 0, 180);
  servoAngle2 = map(potValue2, 0, 4095, 0, 180);


  // 3. Move Servo
  myServo1.write(servoAngle1);
  myServo2.write(servoAngle2);


  // Debugging output
  // Serial.print("Pot: ");
  // Serial.print(potValue);
  // Serial.print(" | Angle: ");
  // Serial.println(servoAngle);

  delay(15); // Wait for servo to get there
}
